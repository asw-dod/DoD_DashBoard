<template>
  <v-app class="mmain">
    <v-app-bar app :style="{ 'background-color': '#79A3B1' }">
      <v-toolbar-title>ASW D.o.D Dap Dashboard</v-toolbar-title>
      <v-spacer></v-spacer>
      <v-toolbar-title>
        ë¶€ì‚°: {{ this.input.weather["temp"] }}â„ƒ ë‚ ì”¨:
        {{ this.input.weather["info"] }}</v-toolbar-title
      >
    </v-app-bar>
    <v-main :style="{ 'background-color': '#DFDFDE' }" :key="componentKey">
      <div class="ma-5">
        <v-row>
          <v-col>
            <h2
              class="list_card_top"
              :style="{ 'background-color': '#79A3B1' }"
            >
              ğŸ“Ÿí•™ì‚¬ê³µì§€
            </h2>
            <v-card class="card-size">
              <div v-for="(Bacn, index) in input.Bachelor" :key="index">
                <v-card-title
                  v-animate-css="'flipInX'"
                  class="font-weight-bold"
                >
                  {{ Bacn.title }}</v-card-title
                >
                <v-card-subtitle v-animate-css="'flipInX'" class="pb-0">
                  ì£¼ìµœ: {{ Bacn.department }} ì‘ì„±ì¼:{{ Bacn.date }}
                </v-card-subtitle>
              </div>
            </v-card>
          </v-col>
          <v-col>
            <h2
              class="list_card_top"
              :style="{ 'background-color': '#79A3B1' }"
            >
              ğŸ’»ì·¨ì—…
            </h2>
            <v-card class="card-size">
              <div v-for="(inter, interx) in input.internship" :key="interx">
                <v-card-title
                  v-animate-css="'flipInX'"
                  class="font-weight-bold"
                >
                  {{ inter[0] + inter[1] }}</v-card-title
                >
              </div>
            </v-card>
          </v-col>
          <v-col>
            <h2
              class="list_card_top"
              :style="{ 'background-color': '#79A3B1' }"
            >
              ğŸ“ƒì°½ì—…êµìœ¡ì„¼í„°
            </h2>
            <v-card class="card-size">
              <div
                v-for="(Enter, Enterx) in input.Entrepreneurship"
                :key="Enterx"
              >
                <v-card-title
                  v-animate-css="'flipInX'"
                  class="font-weight-bold"
                >
                  {{ Enter.title }}</v-card-title
                >
                <v-card-subtitle v-animate-css="'flipInX'" class="pb-0">
                  {{ Enter.date }}
                </v-card-subtitle>
              </div>
            </v-card>
          </v-col>
          <v-col>
            <h2
              class="list_card_top"
              :style="{ 'background-color': '#79A3B1' }"
            >
              ğŸ“°í•™ê³¼ê³µì§€
            </h2>
            <v-card class="card-size">
              <div v-for="(aca, acax) in input.academic" :key="acax">
                <v-card-title
                  v-animate-css="'flipInX'"
                  class="font-weight-bold"
                >
                  {{ aca.title }}</v-card-title
                >
                <v-card-subtitle v-animate-css="'flipInX'" class="pb-0">
                  {{ aca.date }}
                </v-card-subtitle>
              </div>
            </v-card>
          </v-col>
        </v-row>
        <v-row >
          <v-col>
            <h2
              class="list_card_top"
              :style="{ 'background-color': '#79A3B1' }"
            >
              ğŸ•¹ï¸ë¹„êµê³¼
            </h2>
            <v-card class="card-size">
              <div v-for="(non, nonx) in input.non_discipline" :key="nonx">
                <v-card-title
                  v-animate-css="'flipInX'"
                  class="font-weight-bold"
                >
                  {{ non.title }}</v-card-title
                >
                <v-card-subtitle v-animate-css="'flipInX'" class="pb-0">
                  ì‹ ì²­ê¸°ê°„: {{ non.receptionTime }} ê¸°ê°„: {{ non.playTime }}
                </v-card-subtitle>
              </div>
            </v-card>
          </v-col>
          <v-col>
            <h2
              class="list_card_top"
              :style="{ 'background-color': '#79A3B1' }"
            >
              ğŸ’»ì·¨ì—…ê³µì§€
            </h2>
            <v-card class="card-size">
              <div v-for="(job, jobx) in input.job_announcement" :key="jobx">
                <v-card-title
                  v-animate-css="'flipInX'"
                  class="font-weight-bold"
                >
                  {{ job.title }}</v-card-title
                >
                <v-card-subtitle v-animate-css="'flipInX'" class="pb-0">
                  {{ job.date }}
                </v-card-subtitle>
              </div>
            </v-card>
          </v-col>
          <v-col>
            <h2
              class="list_card_top"
              :style="{ 'background-color': '#79A3B1' }"
            >
              ğŸ“­í•™êµê³µì§€
            </h2>
            <v-card class="card-size">
              <div v-for="(sch, shcx) in input.school" :key="shcx">
                <v-card-title
                  v-animate-css="'flipInX'"
                  class="font-weight-bold"
                >
                  {{ sch.title }}</v-card-title
                >
                <v-card-subtitle v-animate-css="'flipInX'" class="pb-0">
                  {{ sch.date }}
                </v-card-subtitle>
              </div>
            </v-card>
          </v-col>
          <v-col class="s_card" :style="{ 'background-color': '#79A3B1' }">
            <h2>ğŸ“Œì˜¤ëŠ˜ ê¸°ìˆ™ì‚¬ ì‹ë‹¨ê³µì§€</h2>
            <v-carousel
              cycle
              height="400"
              :show-arrows="false"
              hide-delimiter-background
              delimiter-icon="mdi-minus"
              class="h_card"
              :style="{ 'background-color': '#DFDFDE' }"
            >
              <v-carousel-item>
                <v-col>
                  <h2>í–‰ë³µê¸°ìˆ™ì‚¬</h2>
                  <h2>ì ì‹¬</h2>
                  <p class="memu-size">
                    [í•œì‹] {{ this.input.happy["ì ì‹¬"] }}<br />[ì¼í’ˆ]{{
                      this.input.happy["ì ì‹¬íŠ¹"]
                    }}
                  </p>
                  <h2>ì €ë…</h2>
                  <p class="memu-size">
                    [í•œì‹] {{ this.input.happy["ì €ë…"] }}<br />[ì¼í’ˆ]{{
                      this.input.happy["ì €ë…íŠ¹"]
                    }}
                  </p>
                </v-col>
              </v-carousel-item>
              <v-carousel-item>
                <v-col>
                  <h2>íš¨ë¯¼ê¸°ìˆ™ì‚¬</h2>
                  <h2>ì•„ì¹¨</h2>
                  <p class="memu-size">
                    {{ this.input.hyomin["ì•„ì¹¨"] }}
                  </p>
                  <h2>ì ì‹¬</h2>
                  <p class="memu-size">
                    {{ this.input.hyomin["ì ì‹¬"] }}
                  </p>
                  <h2>ì €ë…</h2>
                  <p class="memu-size">
                    {{ this.input.hyomin["ì €ë…"] }}
                  </p>
                </v-col>
              </v-carousel-item>
            </v-carousel>
          </v-col>
        </v-row>
      </div>
    </v-main>
    <v-footer app :style="{ 'background-color': '#D1D1D1' }">
      Made by INMD
      <v-spacer></v-spacer>
      Update: {{ this.input.Uptime }}
    </v-footer>
    n>
  </v-app>
</template>

<script>
import dayjs from "dayjs";
import axios from "axios";

export default {
  name: "App",
  components: {},
  data: function () {
    //ì²˜ìŒ ë°ì´í„° ì„¸íŒ…
    return {
      input: {
        Uptime: "",
        hyomin: "",
        happy: "",
        weather: "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...",
        job_announcement: [],
        Bachelor: [],
        non_discipline: [],
        internship: [],
        Entrepreneurship: [],
        academic: [],
        school: [],
      },
      //ì´ ê°’ì€ Fakeì´ê¸° ë•Œë¬¸ì— ë”°ë¡œ 
      //ì‹ ê²½ì“¸ í•„ìš”ê°€ ì—†ë‹¤.
      //í‚¤ê°’ 0~3ê¹Œì§€ ì“´ë‹¤.
      componentKey: 0,
    };
  },
  method: {},
  async mounted() {
    //ë³€ìˆ˜ë¥¼ ì ëŠ” ê³³
    const happy_url =
      "https://dorm.deu.ac.kr/deu/food/getWeeklyMenu.kmc?locgbn=DE&sch_date=";
    const hyomin_url =
      "https://dorm.deu.ac.kr/hyomin/food/getWeeklyMenu.kmc?locgbn=DE&sch_date=";

    //funì„ ì ëŠ”ê³³(ë°˜ë³µì„ ìœ„í•´ì„œ funì„ ì„°ë‹¤.)
    //ì´ funì€ ê¸°ìˆ™ì‚¬ë¥¼ íŒŒì‹±í•´ì„œ ì €ì¥í•˜ëŠ” í•¨ìˆ˜ì´ë‹¤.
    async function getfood(url) {
      const nowdate = dayjs().format("YYYY-MM-DD");
      const responce = await axios(url + nowdate);
      if (url.indexOf("hyomin") != -1) {
        const data = responce.data["root"][0].WEEKLYMENU[0];
        for (let index = 0; index < 8; index++) {
          if (data["fo_date" + index] == nowdate) {
            return {
              ì•„ì¹¨: data["fo_menu_mor" + index],
              ì ì‹¬: data["fo_menu_lun" + index],
              ì €ë…: data["fo_menu_eve" + index],
            };
          }
        }
      } else {
        for (let main_index = 0; main_index < 2; main_index++) {
          const data = responce.data["root"][0].WEEKLYMENU[main_index];
          for (
            let index = 4 * main_index;
            index < 4 + 4 * main_index;
            index++
          ) {
            if (data["fo_date" + index] == nowdate) {
              return {
                ì•„ì¹¨: data["fo_menu_mor" + index],
                ì ì‹¬: data["fo_menu_lun" + index],
                ì ì‹¬íŠ¹: data["fo_sub_lun" + index],
                ì €ë…: data["fo_menu_eve" + index],
                ì €ë…íŠ¹: data["fo_sub_eve" + index],
              };
            }
          }
        }
      }
    }

    async function weather() {
      const opemwather = await axios(
        "https://api.openweathermap.org/data/2.5/weather?q=Busan&appid=" +
          process.env.VUE_APP_token
      );
      const data = opemwather.data;
      console.log((data.main.temp - 273.15).toFixed(2));
      return {
        temp: (data.main.temp - 273.15).toFixed(2),
        info: data.weather[0].main,
      };
    }

    //ì²˜ìŒì— í•œë²ˆë§Œ ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ëŠ”ê³³
    this.input.Uptime = dayjs().format("YYYYë…„ MMì›” DDì¼ HHì‹œmmë¶„ ssì´ˆ");
    this.input.weather = await weather();
    this.input.happy = await getfood(happy_url);
    this.input.hyomin = await getfood(hyomin_url);

    const response = await axios.get("https://api.github.com/repos/asw-dod/dap-macro/issues");

    if (response.data[0].title.indexOf("DAP") != -1){
      const json = JSON.parse(response.data[0].body);
      this.input.Bachelor = json["í•™ì‚¬ê³µì§€"].notice;
      this.input.job_announcement = json["ì·¨ì—…ê³µì§€"].notice;
      this.input.non_discipline = json["ë¹„êµê³¼"].notice;
      this.input.internship = json["ì¸í„´ì‹­"].notice;
      const json1 = JSON.parse(response.data[1].body);
      this.input.Entrepreneurship = json1["ì°½ì—…êµìœ¡ì„¼í„°"];
      this.input.academic = json1["í•™ê³¼ê³µì§€"];
      this.input.school = json1["í•™êµê³µì§€"];
    } else {
      const json = JSON.parse(response.data[1].body);
      this.input.Bachelor = json["í•™ì‚¬ê³µì§€"].notice;
      this.input.job_announcement = json["ì·¨ì—…ê³µì§€"].notice;
      this.input.non_discipline = json["ë¹„êµê³¼"].notice;
      this.input.internship = json["ì¸í„´ì‹­"].notice;
      const json1 = JSON.parse(response.data[0].body);
      this.input.Entrepreneurship = json1["ì°½ì—…êµìœ¡ì„¼í„°"];
      this.input.academic = json1["í•™ê³¼ê³µì§€"];
      this.input.school = json1["í•™êµê³µì§€"];
    }

    //ëª‡ì‹œê°„ ë§ˆë‹¤ ë°˜ë³µí•˜ëŠ” ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ëŠ” ê³³
    //8ì‹œê°„ë§ˆë‹¤ ìƒˆë¡œê³ ì¹¨ì„ í•œë‹¤.
    setInterval(async () => {
      this.input.Uptime = dayjs();
      this.input.weather = await weather();
      this.input.happy = await getfood(happy_url);
      this.input.hyomin = await getfood(hyomin_url);

      const response = await axios.get(
        "https://api.github.com/repos/asw-dod/dap-macro/issues"
      );

      if (response.data[0].title.indexOf("DAP") != -1) {
        const json = JSON.parse(response.data[0].body);
        this.input.Bachelor = json["í•™ì‚¬ê³µì§€"].notice;
        this.input.job_announcement = json["ì·¨ì—…ê³µì§€"].notice;
        this.input.non_discipline = json["ë¹„êµê³¼"].notice;
        this.input.internship = json["ì¸í„´ì‹­"].notice;
        const json1 = JSON.parse(response.data[1].body);
        this.input.Entrepreneurship = json1["ì°½ì—…êµìœ¡ì„¼í„°"];
        this.input.academic = json1["í•™ê³¼ê³µì§€"];
        this.input.school = json1["í•™êµê³µì§€"];
      } else {
        const json = JSON.parse(response.data[1].body);
        this.input.Bachelor = json["í•™ì‚¬ê³µì§€"].notice;
        this.input.job_announcement = json["ì·¨ì—…ê³µì§€"].notice;
        this.input.non_discipline = json["ë¹„êµê³¼"].notice;
        this.input.internship = json["ì¸í„´ì‹­"].notice;
        const json1 = JSON.parse(response.data[0].body);
        this.input.Entrepreneurship = json1["ì°½ì—…êµìœ¡ì„¼í„°"];
        this.input.academic = json1["í•™ê³¼ê³µì§€"];
        this.input.school = json1["í•™êµê³µì§€"];
      }
      this.componentKey = 2;
    }, 28800000);

    //10ë¶„ë§ˆë‹¤ ìƒˆë¡œê³ ì¹¨ì„ í•œë‹¤. (Fake)
    setInterval(async () => {
      //componentKeyí‚¤ëŠ” 0ì—ì„œ 1ë¡œ ì™”ë‹¤ê°”ë‹¤
      //í‚¤ê°’ë§Œ ë°”ê¾¸ì–´ì„œ ì¬ë Œë”©ì„ ì‹œí‚¨ë‹¤.
      if (this.componentKey == 0) {
        this.componentKey = 0;
      } else {
        this.componentKey = 1;
      }
    }, 20000);
  },
};
</script>
